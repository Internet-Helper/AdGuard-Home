# AdGuard Home для Keenetic

AdGuard Home — это удобный и мощный инструмент для управления интернетом в вашей сети на уровне DNS/DHCP.

Для всей сети и каждого устройства отдельно можно:

*   Назначить любое количество DNS-серверов
*   Заблокировать рекламу и трекинг (в пределах возможностей DNS)
*   Включить «безопасный» поиск для детей
*   Ограничить доступ к нежелательным или подозрительным сайтам
*   Блокировать доступ к любым сайтам или приложениям в заданное время (например, к соцсетям перед сном)
*   Просматривать журнал запросов и общую статистику посещений.

Это даёт расширенный контроль над вашей сетью.

## I. Установка

Представленный вариант установки создан на базе этой инструкции - [https://dartraiden.github.io/AdGuard-Home-Keenetic](https://dartraiden.github.io/AdGuard-Home-Keenetic)

1.  Установите поддержку репозитория Entware по инструкции.

2.  Установите AdGuard Home, запустив команды в консоли с Entware:

    ```bash
    opkg update
    opkg install adguardhome-go
    ```

    Дождитесь загрузки и установки.

3.  Отключите DNS-сервер, встроенный в прошивку Keenetic.

    Это нужно чтобы AdGuard Home мог занять 53 порт и обрабатывать DNS-запросы.

    Для этого перейдите по адресу `http://192.168.1.1/a` (или используйте свой актуальный адрес роутера вместо `192.168.1.1`).

    В веб-интерфейсе откроется страница Web cli, с которой можно отправлять команды для роутера:

    ```
    Web cli
    ```

    Введите команду в консоль:

    ```bash
    opkg dns-override
    ```

    Потом эту команду:

    ```bash
    system configuration save
    ```

    Теперь перезагрузите роутер.

4.  Запустите AdGuard Home командой в Entware:

    ```bash
    /opt/etc/init.d/S99adguardhome start
    ```

5.  Откройте в браузере мастер первоначальной настройки AdGuard Home по адресу `http://IP-адрес-роутера:3000`

    Если всё стандартно, то адрес будет такой - `http://192.168.1.1:3000`

6.  Произведите первоначальную настройку:

    *   Веб-интерфейс повесьте на "Все интерфейсы", порт `1234` или любой выше от `1000` до `65535`.
    *   DNS-сервер повесьте на "Все интерфейсы", порт `53`.
    *   Также придумайте логин и пароль (чтобы не усложнять, можно использовать логин/пароль от админки роутера).

7.  Измените адрес DNS в роутере на `IP-адрес-роутера` (в нашем примере это `192.168.1.1`) - это DNS адрес самого AdGuard Home.

    Так же нужно выбрать "Игнорировать DNSv4 DNS интернет-провайдера", если есть, и DNSv6 тоже.

8.  Теперь зайдите по адресу `http://IP-адрес-роутера:1234` (в нашем примере - `http://192.168.1.1:1234`) для дальнейшей настройки.

## II. Настройка

Дальнейший вариант настройки является лишь рекомендацией. Меняйте всё, что считаете нужным, под свои нужды.

Почему именно Сomss главный DNS-сервер?

Он позволяет обойти ограничения для сайтов, которые сами блокируют доступ пользователям из России. Например ChatGPT, Google Gemini, Canva, обновления антивирусов, инсайдерские сборки и обновления Windows, Brawl Stars, сетевые режимы Doom Eternal и многое другое, но не все подобные сайты.
Актуальные адреса DNS Comss всегда можно найти по этой ссылке: [https://www.comss.ru/page.php?id=7315](https://www.comss.ru/page.php?id=7315)

Для Instagram, Facebook и X (Twitter) нужны другие DNS-сервера так как они предоставляют незаблокированные европейские IP-адреса так как Comss выдает заблокированные. Это актуально для тех, у кого установлен NFQWS или zapret.

Начнем настройку.

Нажмите в самом верху на "Настройки" → "Основные настройки":

Раздел "Настройка журнала":

*   Уберите галочку с "Включить журнал" (рекомендую включать в ситуациях, только когда это действительно нужно чтобы не тратить попусту ресурс вашей флешки/внутренней памяти роутера).
*   Выберите `24 часа` в "Частота ротации журнала запросов"

Раздел "Конфигурация статистики":

*   Поставьте галочку на "Включить статистику"
*   Выберите `24 часа` в "Сохранение статистики"

Нажмите в самом верху на "Настройки" → "Настройки DNS":

**Upstream DNS-серверы**

 ```bash
https://router.comss.one/dns-query
https://dns.comss.one/dns-query
tls://dns.comss.one
quic://dns.comss.one
#Соцсети
[/cdninstagram.com/facebook.com/facebook.net/fbcdn.com/fbcdn.net/ig.me/instagram.com/facebook.com.es/facebook.com.vn/facebook.fr/fb.com/fb.me/fbsbx.com/licdn.com/tfbnw.net/thefacebook.com/akamaized.net/twimg.com/twitter.com/x.com/tweetdeck.com/t.co/]https://ns1.opennameserver.org/dns-query https://ns2.opennameserver.org/dns-query https://ns3.opennameserver.org/dns-query
```
